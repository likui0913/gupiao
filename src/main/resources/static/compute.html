<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>详细数据</title>
</head>

<!--  -->
<style type="text/css">
    .show_table {
        font-family: 'Helvetica Neue';
    }
</style>

<!-- 引入js文件 -->
<script type="text/javascript" src="js/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="js/jquery.param.min.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/echarts.min.js"></script>

<body>

<div>
    编码:<input id="code" value="000417"><br>
    开始:<input id="startDate" type="date" name="trip-start" value="2022-05-01" min="2000-01-01" max="2050-12-31">
    结束:<input id="endDate" type="date" name="trip-start" value="2022-05-01" min="2000-01-01" max="2050-12-31"><br>
    标记:<select id="stockSign" value="0">
            <option value="0">无</option>
            <option value="1">收藏</option>
        </select><br>
    行业:<select id="industrySearch" value="0">
        <option value="0">无</option>
        <option value="1">银行</option>
        <option value="2">房地产开发</option>
        <option value="3">软件开发</option>
        <option value="4">环保行业</option>
        <option value="5">房地产服务</option>
        <option value="6">交运设备</option>
        <option value="7">综合行业</option>
        <option value="8">工程建设</option>
        <option value="9">玻璃玻纤</option>
        <option value="10">家电行业</option>
        <option value="11">贸易行业</option>
        <option value="12">光学光电子</option>
        <option value="13">消费电子</option>
        <option value="14">水泥建材</option>
        <option value="15">汽车服务</option>
        <option value="16">珠宝首饰</option>
        <option value="17">电力行业</option>
        <option value="18">医药商业</option>
        <option value="19">汽车零部件</option>
        <option value="20">通信设备</option>
        <option value="21">计算机设备</option>
        <option value="22">文化传媒</option>
        <option value="23">通用设备</option>
        <option value="24">多元金融</option>
        <option value="25">电池</option>
        <option value="26">装修装饰</option>
        <option value="27">商业百货</option>
        <option value="28">石油行业</option>
        <option value="29">有色金属</option>
        <option value="30">电子元件</option>
        <option value="31">航运港口</option>
        <option value="32">航空机场</option>
        <option value="33">医疗服务</option>
        <option value="34">化学制药</option>
        <option value="35">工程机械</option>
        <option value="36">证券</option>
        <option value="37">化纤行业</option>
        <option value="38">电网设备</option>
        <option value="39">生物制品</option>
        <option value="40">燃气</option>
        <option value="41">化肥行业</option>
        <option value="42">互联网服务</option>
        <option value="43">化学原料</option>
        <option value="44">中药</option>
        <option value="45">旅游酒店</option>
        <option value="46">铁路公路</option>
        <option value="47">造纸印刷</option>
        <option value="48">农牧饲渔</option>
        <option value="49">贵金属</option>
        <option value="50">专用设备</option>
        <option value="51">美容护理</option>
        <option value="52">农药兽药</option>
        <option value="53">教育</option>
        <option value="54">食品饮料</option>
        <option value="55">公用事业</option>
        <option value="56">汽车整车</option>
        <option value="57">煤炭行业</option>
        <option value="58">物流行业</option>
        <option value="59">化学制品</option>
        <option value="60">酿酒行业</option>
        <option value="61">橡胶制品</option>
        <option value="62">装修建材</option>
        <option value="63">保险</option>
        <option value="64">钢铁行业</option>
        <option value="65">小金属</option>
        <option value="66">包装材料</option>
        <option value="67">半导体</option>
        <option value="68">航天航空</option>
        <option value="69">医疗器械</option>
        <option value="70">纺织服装</option>
        <option value="71">采掘行业</option>
        <option value="72">工程咨询服务</option>
        <option value="73">塑料制品</option>
        <option value="74">通信服务</option>
        <option value="75">电机</option>
        <option value="76">家用轻工</option>
        <option value="77">仪器仪表</option>
        <option value="78">非金属材料</option>
        <option value="79">专业服务</option>
        <option value="80">游戏</option>
        <option value="81">光伏设备</option>
        <option value="82">能源金属</option>
        <option value="83">风电设备</option>
        <option value="84">电源设备</option>
        <option value="85">电子化学品</option>
        <option value="86">船舶制造</option>
    </select>
    <button id="compute">计算</button><br>
</div>

<hr>
<div>
    id:<input id="stockID" readonly="readonly"><br>
    编码:<input id="stockCode" readonly="readonly"><br>
    标记:<input id="isFocus" readonly="readonly"><br>
    名称:<input id="stockName" readonly="readonly"><br>
    上市时间:<input id="stockStartDate" readonly="readonly"><br>
    行业:<input id="stockIndustry" readonly="readonly"><br>
</div>
<div>
    <div id="echartLine" style="width: 80%;height: 300px"></div>
</div>
<div>
    <div id="echartQuoteLine" style="width: 80%;height: 300px"></div>
</div>
<div>
    <button id="upLast">上一个</button>
    <button id="upNext">下一个</button>
</div>
<hr>
<div>
    <table id="resTable" border="1" cellspacing="0" class="show_table">
        <tr>
            <th>日期</th>
            <th>指标</th>
            <th>结果</th>
            <!-- 当天交易的详细数据 -->
            <th>开盘</th>
            <th>收盘</th>
            <th>成交量</th>
            <th>成交额</th>
            <th>换手率</th>
        </tr>
    </table>
</div>

<button id="last">上一个</button>
<button id="next">下一个</button>
<button id="focus">收藏</button>

<script type="text/javascript">
    $(document).ready(function (){

        init();

        const codeElement = document.querySelector("#code");
        codeElement.addEventListener("input",inputEvent);
        codeElement.addEventListener("click",clickEvent);

        //code输入框输入事件
        function inputEvent(e){}

        //code输入框点击事件，选中事件
        function clickEvent(e){}

        //计算详细信息
        $("#compute").click(function (){

            //获取处理输入信息
            var code = document.getElementById("code").value;
            var startDate = document.getElementById("startDate").value;
            var endDate = document.getElementById("endDate").value;

            if(null == code || "" === code){
                alert("code不能为空");
                return;
            }else if(code.length !== 6){
                alert("code长度必须为6");
                return;
            }

            if(startDate >= endDate){
                alert("开始时间不能大于等于结束时间");
                return;
            }

            //构建查询参数
            var stockParam = {}
            stockParam.code = code

            $.ajax({
                url:globalConfig.remoteUlr + "query/stock/detail",
                type:"POST",
                dataType:"json",
                contentType:"application/json;charset=utf8",
                async:false,
                data: JSON.stringify(stockParam),
                success:function (resJson){
                    if(resJson.status === false && resJson.msg === "未登录"){
                        window.location.href="index.html";
                        return;
                    }
                    if(resJson.status === true){
                        updateStockDetail(resJson);
                        return;
                    }else{
                        alert("后端处理失败！");
                        return;
                    }
                },
                error:function (err){}
            })

            var computeParameter = {};
            computeParameter.code = code;
            computeParameter.startDate = startDate;
            computeParameter.endDate = endDate;

            var resJsonCompute = getComputeData(computeParameter);
            updateTable(resJsonCompute,true);

        });

        //查询上一个
        $("#last").click(function (){

            //获取处理输入信息
            var code = document.getElementById("code").value;
            var startDate = document.getElementById("startDate").value;
            var endDate = document.getElementById("endDate").value;

            if(null == code || "" === code){
                alert("code不能为空");
                return;
            }else if(code.length !== 6){
                alert("code长度必须为6");
                return;
            }

            if(startDate >= endDate){
                alert("开始时间不能大于等于结束时间");
                return;
            }

            var newCode = null;

            var stockSign = document.getElementById("stockSign").value;
            var focus = null;
            if(parseInt(stockSign) === 1){
                focus = "1";
            }
            var industrySearch = document.getElementById("industrySearch");
            var industrySearchValue = industrySearch.options[industrySearch.selectedIndex].text;

            var stockParameter = {};
            stockParameter.code = code;
            stockParameter.isFocus = focus;
            if( 0 !== parseInt(industrySearch.selectedIndex)){
                stockParameter.industry = industrySearchValue;
            }

            $.ajax({
                url:globalConfig.remoteUlr + "query/stock/lastDetail",
                type:"POST",
                dataType:"json",
                contentType:"application/json;charset=utf8",
                async:false,
                data:JSON.stringify(stockParameter),
                success:function (resJson){
                    if(resJson.status === false && resJson.msg === "未登录"){
                        window.location.href="index.html";
                        return;
                    }
                    if(resJson.status === true){
                        newCode = resJson.msg.stockCode;
                        updateStockDetail(resJson);
                        return;
                    }else{
                        alert("后端处理失败！");
                        return;
                    }
                },
                error:function (err){}
            })

            if(null === newCode){
                return;
            }

            var computeParameter = {};
            computeParameter.code = newCode;
            computeParameter.startDate = startDate;
            computeParameter.endDate = endDate;

            var resJsonCompute = getComputeData(computeParameter);
            updateTable(resJsonCompute,true);

        });

        //查询下一个
        $("#next").click(function (){

            //获取处理输入信息
            var code = document.getElementById("code").value;
            var startDate = document.getElementById("startDate").value;
            var endDate = document.getElementById("endDate").value;

            if(null == code || "" === code){
                alert("code不能为空");
                return;
            }else if(code.length !== 6){
                alert("code长度必须为6");
                return;
            }

            if(startDate >= endDate){
                alert("开始时间不能大于等于结束时间");
                return;
            }

            var newCode = null;

            var stockSign = document.getElementById("stockSign").value;
            var focus = null;
            if(parseInt(stockSign) === 1){
                focus = "1";
            }
            var industrySearch = document.getElementById("industrySearch");
            var industrySearchValue = industrySearch.options[industrySearch.selectedIndex].text;

            var stockParameter = {};
            stockParameter.code = code;
            stockParameter.isFocus = focus;
            if( 0 !== parseInt(industrySearch.selectedIndex)){
                stockParameter.industry = industrySearchValue;
            }

            $.ajax({
                url:globalConfig.remoteUlr + "query/stock/nextDetail",
                type:"POST",
                dataType:"json",
                contentType:"application/json;charset=utf8",
                async:false,
                data:JSON.stringify(stockParameter),
                success:function (resJson){
                    if(resJson.status === false && resJson.msg === "未登录"){
                        window.location.href="index.html";
                        return;
                    }
                    if(resJson.status === true){
                        newCode = resJson.msg.stockCode;
                        updateStockDetail(resJson);
                        return;
                    }else{
                        alert("后端处理失败！");
                        return;
                    }
                },
                error:function (err){}
            })

            if(null === newCode){
                return;
            }

            var computeParameter = {};
            computeParameter.code = newCode;
            computeParameter.startDate = startDate;
            computeParameter.endDate = endDate;

            var resJsonCompute = getComputeData(computeParameter);
            updateTable(resJsonCompute,true);

        });

        //查询上一个
        $("#upLast").click(function (){
            $("#last").click();
        });

        //查询下一个
        $("#upNext").click(function (){
            $("#next").click();
        });

        //收藏
        $("#focus").click(function (){

            //收藏必须现有code信息
            var code = document.getElementById("stockCode").value;

            if(null == code || "" === code){
                alert("code不能为空");
                return;
            }else if(code.length !== 6){
                alert("code长度必须为6");
                return;
            }

            var focusValue = 0;
            if("收藏" === document.getElementById("isFocus").value){
                //界面显示收藏，则标记为取消
                focusValue = 0;
            }else{
                //界面显示为取消，则标记为收藏
                focusValue = 1;
            }

            $.ajax({
                url:globalConfig.remoteUlr + "query/stock/isFocus",
                type:"POST",
                dataType:"text",
                async:false,
                data:{
                    code:code,
                    isFocus:focusValue
                },
                success:function (resData){
                    const resJson = JSON.parse(resData);
                    if(resJson.status === false && resJson.msg === "未登录"){
                        window.location.href="index.html";
                        return;
                    }
                    if(resJson.status === true){

                        //执行成功，刷新界面显示值
                        if( 1 === focusValue){
                            document.getElementById("isFocus").value = "收藏"
                        }else{
                            document.getElementById("isFocus").value = "无"
                        }

                        alert("收藏成功！");
                        return;
                    }else{
                        alert("后端处理失败！");
                        return;
                    }
                },
                error:function (err){}
            })

        });

        function init(){

            var code = getUrlParameter('code');
            var startDate = getUrlParameter('startDate');
            var endDate = getUrlParameter('endDate');

            document.getElementById('code').value = code;
            if(null !== startDate && startDate.length === 10){
                document.getElementById('startDate').value = startDate;
            }
            if(null !== endDate && endDate.length === 10){
                document.getElementById('endDate').value = endDate;
            }

        };

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
            return false;
        };

        <!-- 刷新表格内数据 -->
        function updateTable(resJson,isUpdate){

            var myChart = echarts.init(document.getElementById('echartLine'));
            var myQuoteChart = echarts.init(document.getElementById('echartQuoteLine'));

            if(isUpdate === true){
                $("#resTable").find("tr:not(:first)").remove();
                myChart.clear();
                myQuoteChart.clear();
            }

            var tab = document.getElementById("resTable");

            var xAxis = new Array();
            var yAxisData = new Array();
            var yAxisQuoteData = new Array();
            var size = 0;

            for(var i in resJson.msg){

                var tradd = tab.insertRow();
                var colorSet = "#FF5900FF";

                if(parseFloat(resJson.msg[i].quoteChange) > 9.5){
                    colorSet = "#FF0000";
                }else if(parseFloat(resJson.msg[i].quoteChange) > 0){
                    colorSet = "#EE00FFD7";
                }else if(parseFloat(resJson.msg[i].quoteChange) > -9.5 ){
                    colorSet = "#92D711FF";
                }else{
                    colorSet = "#4dd711";
                }

                tradd.innerHTML=
                    '<td  align="right">' + resJson.msg[i].date + '</td><td  align="right" bgcolor="'+ colorSet +'">'
                    + resJson.msg[i].quoteChange + '</td><td align="right">'
                    + resJson.msg[i].transactionResults + '</td><td align="right">'
                    + resJson.msg[i].marketData.openingPrice + '</td><td align="right">'
                    + resJson.msg[i].marketData.closingPrice + '</td><td align="right">'
                    + resJson.msg[i].marketData.volume + '</td><td align="right">'
                    + resJson.msg[i].marketData.turnover + '</td><td align="right">'
                    + resJson.msg[i].marketData.turnoverRate + '</td>';
                //绿色：#4dd711 红色：#FF0000

                xAxis[size] = resJson.msg[i].date;
                yAxisData[size] = resJson.msg[i].transactionResults;
                yAxisQuoteData[size] = resJson.msg[i].quoteChange;
                size++;
            }

            const option = {
                title: {text: '走势图'},
                tooltip: {},
                legend: {data: ['结果']},
                xAxis: {data: xAxis},
                yAxis: {},
                series: [{
                    name: '结果',
                    type: 'line',
                    data: yAxisData
                }]
            };

            const optionQuote = {
                title: {text: '走势图'},
                tooltip: {},
                legend: {data: ['结果']},
                xAxis: {data: xAxis},
                yAxis: {},
                series: [{
                    name: '结果',
                    type: 'line',
                    data: yAxisQuoteData
                }]
            };
            myChart.setOption(option);
            myQuoteChart.setOption(optionQuote);
        }

        function updateStockDetail(resJson){

            document.getElementById("stockID").value = resJson.msg.id;
            if(resJson.msg.focus === 1){
                document.getElementById("isFocus").value = "收藏"
            }else{
                document.getElementById("isFocus").value = "无"
            }
            document.getElementById("stockCode").value = resJson.msg.stockCode;
            document.getElementById("stockName").value = resJson.msg.stockName;
            document.getElementById("stockStartDate").value = resJson.msg.marketTime;
            document.getElementById("stockIndustry").value = resJson.msg.industry;

            document.getElementById("code").value = resJson.msg.stockCode;

        }

        function getComputeData(sParam){

            var res = "";
            $.ajax({
                url:globalConfig.remoteUlr + "compute/compute",
                type:"POST",
                dataType:"json",
                contentType:"application/json;charset=utf8",
                async:false,
                data: JSON.stringify(sParam),
                success:function (resJson){

                    if(resJson.status === false && resJson.msg === "未登录"){
                        window.location.href="index.html";
                        return "";
                    }
                    if(resJson.status === true){
                        res = resJson;
                    }else{
                        alert("后端处理失败！");
                        return "";
                    }
                },
                error:function (err){res = null}
            })

            return res;
        }

    });
</script>

</body>

</html>